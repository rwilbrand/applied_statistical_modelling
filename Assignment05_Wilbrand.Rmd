---
title: "ASM Assignment 05"
author: "Robert Wilbrand"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, message = FALSE, warning = FALSE}
# load necessary packages
library(tidyverse)
library(brms)

# set global options
theme_set(theme_minimal())
knitr::opts_knit$set(root.dir = "C:/MSc GCG/2021_SoSe/ASM")
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
options(scipen = 8) # disables scientific notation up to 8 digits

# Wrapper function to set a specified seed prior to function execution
# useful because it leaves the seed outside the function unaffected
seedFunc <- function(seed, func, ...){
  set.seed(seed)
  func(...)
}
```

```{r}
# Define data
birdMatrix <- rbind("Island 1" = rep(.2, 5),
                    "Island 2" = c(.8,.1,.05,.025,.025),
                    "Island 3" = c(.05,.15,.7,.05,.05))
colnames(birdMatrix) <- str_c("Species ", LETTERS[1:5])
```

## 7H3.
Consider three fictional Polynesian islands. On each there is a Royal Ornithologist charged by the king with surveying the bird population. They have each found the following proportions of 5 important bird species:

```{r, echo=FALSE}
flextable::flextable(birdMatrix %>% 
                       as.data.frame %>%
                       rownames_to_column(var = " "),
                     cwidth = 1)
```

Notice that each row sums to 1, all the birds. This problem has two parts. It is not computationally complicated. But it is conceptually tricky. First, compute the entropy of each island’s bird distribution. Interpret these entropy values. Second, use each island’s bird distribution to predict the other two. This means to compute the KL divergence of each island from the others, treating each island as if it were a statistical model of the other islands. You should end up with 6 different KL divergence values. Which island predicts the others best? Why?

```{r}
# Define entropy and KL divergence functions
entropy <- function(p) -sum(p * log(p))
divKL <- function(p, q) sum(p * log(p/q))

# Iterate over rows to determine entropy
map_dbl(1:3, ~entropy(birdMatrix[.x,]))

# Create a dataframe of all possible combinations
combis <- expand.grid(1:3, 1:3) %>% filter(Var1 != Var2)

# Iterate over combinations to determine KL divergence
islandKLs <- map2_dbl(combis[,1], combis[,2],
                      ~divKL(birdMatrix[.x,], birdMatrix[.y,]))

# Combine into one dataframe, arrange by KL divergence
islandModels <-
  transmute(combis, "Model" = str_c(Var1, " predicts ", Var2)) %>% 
  bind_cols(islandKLs) %>% 
  rename("KL divergence" = "...2") %>% 
  arrange(`KL divergence`)

flextable::flextable(islandModels, cwidth = 1.5)
```
